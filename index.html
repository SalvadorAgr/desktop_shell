<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Desktop Shell</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: transparent;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            overflow: hidden;
        }

        .window-container {
            width: 100vw;
            height: 100vh;
            position: relative;
            background: transparent;
        }

        .notch-container {
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            z-index: 10;
        }

        .notch-svg {
            width: 257px;
            height: 32px;
        }

        .canvas-task-container {
            position: absolute;
            top: 35px;
            left: 7px;
            right: 7px;
            bottom: 7px;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 0;
            transition: gap 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .container-panel-open {
            gap: 4px;
        }

        .main-canvas-wrapper {
            height: 100%;
            flex: 1;
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            min-width: 0;
        }

        .task-panel-wrapper {
            width: 0;
            height: 100%;
            overflow: hidden;
            transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            flex-shrink: 0;
        }

        .container-panel-open .task-panel-wrapper {
            width: 250px;
        }

        .canvas-task-svg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: block;
        }

        .task-panel-svg {
            display: block;
            width: 100%;
            /* Make task panel SVG responsive to its wrapper */
            height: 100%;
        }

        .dock-icon {
            cursor: pointer;
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            transform-origin: center;
            transform-box: fill-box;
            will-change: transform;
        }

        .dock-icon:hover {
            transform: scale3d(1.167, 1.167, 1);
        }

        .dock-icon-area {
            fill: transparent;
            cursor: pointer;
        }

        /* Functional SplitView Panes (Tier II Elite Implementation) */
        .panes-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: none;
            grid-template-columns: 1fr 4px 1fr;
            z-index: 5;
            pointer-events: none;
            mask: url(#split-mask);
            -webkit-mask: url(#split-mask);
        }

        .splitview-active .panes-container {
            display: grid;
        }

        .webview-pane {
            pointer-events: auto;
            position: relative;
            overflow: hidden;
            background: transparent;
            border-radius: 5px;
        }

        #splitview-trigger {
            cursor: pointer;
        }

        .canvas-overlay-svg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: block;
            z-index: 15;
            pointer-events: none;
        }

        .canvas-overlay-svg * {
            pointer-events: auto;
        }

        #splitview-divider {
            cursor: col-resize;
        }

        #divider-handle {
            opacity: 0;
            transition: opacity 1s ease-in-out;
        }

        #splitview-divider.active-handle #divider-handle {
            opacity: 1;
        }

        #splitview-divider.idle #divider-handle {
            opacity: 0.25;
        }

        #splitview-divider:hover #divider-handle {
            opacity: 1 !important;
        }
    </style>
</head>

<body>
    <div class="window-container">
        <div class="notch-container">
            <svg class="notch-svg" width="257" height="32" viewBox="0 0 257 32" fill="none"
                xmlns="http://www.w3.org/2000/svg">
                <g filter="url(#filter0_d_613_14402)">
                    <path
                        d="M226.359 25H30.0317C16.5869 25 16.9095 0.0152438 3.80292 5.13195e-05C3.19224 4.8893e-05 3.16682 4.5991e-05 3.78789 4.25653e-05C3.79291 4.25377e-05 3.79791 4.5515e-05 3.80292 5.13195e-05C9.96421 7.58007e-05 75.7006 5.1886e-05 138.149 2.91673e-05L252.87 1.37564e-05C239.614 7.39814e-05 239.614 25 226.359 25Z"
                        fill="#0A0A0A" />
                </g>
                <path d="M115.381 6H120.256L119.356 6.66661H116.233L115.381 6Z" fill="#ACACAC" />
                <path
                    d="M116.091 9.66724H119.498L120.161 10.0005L119.498 10.3338H116.091L115.475 10.0005L116.091 9.66724Z"
                    fill="#0E0E0E" />
                <path d="M115.333 9.9165L115.333 6.16683L116.091 6.79178L116.091 9.49987L115.333 9.9165Z"
                    fill="#ACACAC" />
                <path d="M120.256 6.20898L120.256 9.91699L119.498 9.50036L119.498 6.79227L120.256 6.20898Z"
                    fill="#ACACAC" />
                <path d="M120.066 14L115.523 14L116.233 13.3334L119.356 13.3334L120.066 14Z" fill="#ACACAC" />
                <path d="M120.256 10.1255L120.256 13.9168L119.498 13.2502L119.498 10.5005L120.256 10.1255Z"
                    fill="#ACACAC" />
                <path d="M115.333 13.9153L115.333 10.0823L116.091 10.4989L116.091 13.207L115.333 13.9153Z"
                    fill="#ACACAC" />
                <path d="M121.439 6H126.314L125.415 6.66661H122.291L121.439 6Z" fill="#ACACAC" />
                <path
                    d="M122.149 9.66724H125.557L126.219 10.0005L125.557 10.3338H122.149L121.534 10.0005L122.149 9.66724Z"
                    fill="#ACACAC" />
                <path d="M121.392 9.9165L121.392 6.16683L122.149 6.79178L122.149 9.49987L121.392 9.9165Z"
                    fill="#ACACAC" />
                <path d="M126.314 6.20898L126.314 9.91699L125.557 9.50036L125.557 6.79227L126.314 6.20898Z"
                    fill="#161616" />
                <path d="M126.125 14L121.581 14L122.291 13.3334L125.415 13.3334L126.125 14Z" fill="#ACACAC" />
                <path d="M126.314 10.1255L126.314 13.9168L125.557 13.2502L125.557 10.5005L126.314 10.1255Z"
                    fill="#ACACAC" />
                <path d="M121.392 13.9153L121.392 10.0823L122.149 10.4989L122.149 13.207L121.392 13.9153Z"
                    fill="#ACACAC" />
                <path d="M129.58 6H134.455L133.556 6.66661H130.432L129.58 6Z" fill="#ACACAC" />
                <path d="M130.29 9.66724H133.698L134.36 10.0005L133.698 10.3338H130.29L129.675 10.0005L130.29 9.66724Z"
                    fill="#161616" />
                <path d="M129.533 9.9165L129.533 6.16683L130.29 6.79178L130.29 9.49987L129.533 9.9165Z"
                    fill="#ACACAC" />
                <path d="M134.455 6.20898L134.455 9.91699L133.698 9.50036L133.698 6.79227L134.455 6.20898Z"
                    fill="#ACACAC" />
                <path d="M134.266 14L129.722 14L130.432 13.3334L133.556 13.3334L134.266 14Z" fill="#ACACAC" />
                <path d="M134.455 10.1255L134.455 13.9168L133.698 13.2502L133.698 10.5005L134.455 10.1255Z"
                    fill="#ACACAC" />
                <path d="M129.533 13.9153L129.533 10.0823L130.29 10.4989L130.29 13.207L129.533 13.9153Z"
                    fill="#ACACAC" />
                <path d="M135.638 6H140.513L139.614 6.66661H136.49L135.638 6Z" fill="#161616" />
                <path
                    d="M136.348 9.66724H139.756L140.419 10.0005L139.756 10.3338H136.348L135.733 10.0005L136.348 9.66724Z"
                    fill="#ACACAC" />
                <path d="M135.591 9.9165L135.591 6.16683L136.348 6.79178L136.348 9.49987L135.591 9.9165Z"
                    fill="#ACACAC" />
                <path d="M140.513 6.20898L140.513 9.91699L139.756 9.50036L139.756 6.79227L140.513 6.20898Z"
                    fill="#ACACAC" />
                <path d="M140.324 14L135.78 14L136.49 13.3334L139.614 13.3334L140.324 14Z" fill="#161616" />
                <path d="M140.513 10.1255L140.513 13.9168L139.756 13.2502L139.756 10.5005L140.513 10.1255Z"
                    fill="#ACACAC" />
                <path d="M135.591 13.9153L135.591 10.0823L136.348 10.4989L136.348 13.207L135.591 13.9153Z"
                    fill="#161616" />
                <rect x="127.45" y="8.91553" width="0.946613" height="0.83326" fill="#ACACAC" />
                <rect x="127.45" y="10.4167" width="0.946613" height="0.83326" fill="#ACACAC" />
                <defs>
                    <filter id="filter0_d_613_14402" x="4.07696e-05" y="0" width="256.203" height="26.6667"
                        filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB">
                        <feFlood flood-opacity="0" result="BackgroundImageFix" />
                        <feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"
                            result="hardAlpha" />
                        <feOffset dy="3.33333" />
                        <feGaussianBlur stdDeviation="1.66667" />
                        <feComposite in2="hardAlpha" operator="out" />
                        <feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.25 0" />
                        <feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow_613_14402" />
                        <feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow_613_14402" result="shape" />
                    </filter>
                </defs>
            </svg>
        </div>
        <div class="canvas-task-container" id="main-container">
            <div class="main-canvas-wrapper">
                <svg class="canvas-task-svg" viewBox="0 0 1236 658" fill="none" xmlns="http://www.w3.org/2000/svg"
                    preserveAspectRatio="none">
                    <g clip-path="url(#clip0_595_14217)">
                        <path id="main-canvas-path" d="" fill="#0A0A0A" />
                        <defs>
                            <clipPath id="clip0_595_14217">
                                <rect width="100%" height="100%" fill="white" />
                            </clipPath>
                            <mask id="split-mask">
                                <g id="mask-full-group">
                                    <path id="mask-full" d="" fill="white" />
                                </g>
                                <g id="mask-split-group" style="display: none;">
                                    <path id="pane-left-mask-path" d="" fill="white" />
                                    <path id="pane-right-mask-path" d="" fill="white" />
                                </g>
                            </mask>
                            <clipPath id="zipper-clip-split">
                                <rect id="zipper-rect-split" x="0" y="0" width="100%" height="0" />
                            </clipPath>
                            <clipPath id="zipper-clip-full">
                                <rect id="zipper-rect-full" x="0" y="0" width="100%" height="100%" />
                            </clipPath>
                        </defs>
                    </g>
                </svg>

                <svg class="canvas-overlay-svg" viewBox="0 0 1236 658" fill="none" xmlns="http://www.w3.org/2000/svg"
                    preserveAspectRatio="none">
                    <!-- SplitView Separator (Elite Transparency) -->
                    <g id="splitview-divider" style="display: none;">
                        <rect x="-2" y="0" width="11" height="100%" fill="transparent" />
                        <rect id="divider-handle" x="1" y="289.5" width="2" height="50" rx="1" fill="#999999" />
                    </g>

                    <g id="dock-elements">
                        <line x1="539.607" y1="633.107" x2="539.607" y2="652.893" stroke="url(#paint0_linear_595_14217)"
                            stroke-width="0.214453" stroke-linecap="round" />

                        <!-- First dock icon group (SplitView Trigger) -->
                        <g class="dock-icon" id="splitview-trigger">
                            <rect class="dock-icon-area" x="555" y="628" width="30" height="30" />
                            <path
                                d="M569.214 648.5H566.982C566.242 648.5 565.643 647.9 565.643 647.161V639.125C565.643 638.385 566.242 637.786 566.982 637.786H569.214"
                                stroke="#D1D1D1" stroke-width="0.714286" stroke-linecap="round" />
                            <path
                                d="M572.071 648.5H574.304C575.043 648.5 575.643 647.9 575.643 647.161V639.125C575.643 638.385 575.043 637.786 574.304 637.786H572.071"
                                stroke="#D1D1D1" stroke-width="0.714286" stroke-linecap="round" />
                            <path d="M570.643 636V650.286" stroke="#D1D1D1" stroke-width="0.714286"
                                stroke-linecap="round" />
                        </g>

                        <line x1="602.607" y1="633.107" x2="602.607" y2="652.893" stroke="url(#paint1_linear_595_14217)"
                            stroke-width="0.214453" stroke-linecap="round" />

                        <!-- Second dock icon group -->
                        <g class="dock-icon">
                            <rect class="dock-icon-area" x="610" y="628" width="30" height="30" />
                            <path
                                d="M620.25 643.349C620.25 642.397 620.25 641.921 620.456 641.503C620.662 641.084 621.048 640.775 621.821 640.155L622.571 639.554C623.969 638.435 624.668 637.875 625.5 637.875C626.332 637.875 627.031 638.435 628.429 639.554L629.179 640.155C629.952 640.775 630.338 641.084 630.544 641.503C630.75 641.921 630.75 642.397 630.75 643.349V646.321C630.75 647.643 630.75 648.304 630.311 648.714C629.871 649.125 629.164 649.125 627.75 649.125H623.25C621.836 649.125 621.129 649.125 620.689 648.714C620.25 648.304 620.25 647.643 620.25 646.321V643.349Z"
                                stroke="#D1D1D1" stroke-width="0.850003" />
                            <path
                                d="M627 649.125V646.048C627 645.676 626.699 645.375 626.327 645.375H624.673C624.301 645.375 624 645.676 624 646.048V649.125"
                                stroke="#D1D1D1" stroke-width="0.850003" stroke-linecap="round"
                                stroke-linejoin="round" />
                        </g>

                        <line x1="649.607" y1="633.107" x2="649.607" y2="652.893" stroke="url(#paint2_linear_595_14217)"
                            stroke-width="0.214453" stroke-linecap="round" />

                        <!-- Third dock icon group (Task Panel Trigger) -->
                        <g class="dock-icon" id="panel-trigger">
                            <rect class="dock-icon-area" x="658" y="628" width="30" height="30" />
                            <path
                                d="M672.643 648.643H668.982C668.242 648.643 667.643 648.043 667.643 647.304V638.982C667.643 638.242 668.242 637.643 668.982 637.643H672.643"
                                stroke="#D1D1D1" stroke-width="0.714286" stroke-linecap="round" />
                            <path
                                d="M673.643 648.643H677.304C678.043 648.643 678.643 648.043 678.643 647.304V638.982C678.643 638.242 678.043 637.643 677.304 637.643H673.643"
                                stroke="#D1D1D1" stroke-width="0.714286" stroke-linecap="round" />
                            <rect x="673.5" y="639" width="4" height="8" rx="0.714286" fill="#D1D1D1" />
                        </g>

                        <line x1="696.607" y1="633.107" x2="696.607" y2="652.893" stroke="url(#paint3_linear_595_14217)"
                            stroke-width="0.214453" stroke-linecap="round" />
                    </g>
                    <defs>
                        <linearGradient id="paint0_linear_595_14217" x1="539" y1="633" x2="539" y2="653"
                            gradientUnits="userSpaceOnUse">
                            <stop stop-color="white" stop-opacity="0" />
                            <stop offset="0.480769" stop-color="#CACACA" />
                            <stop offset="1" stop-color="#999999" stop-opacity="0" />
                        </linearGradient>
                        <linearGradient id="paint1_linear_595_14217" x1="602" y1="633" x2="602" y2="653"
                            gradientUnits="userSpaceOnUse">
                            <stop stop-color="white" stop-opacity="0" />
                            <stop offset="0.480769" stop-color="#CACACA" />
                            <stop offset="1" stop-color="#999999" stop-opacity="0" />
                        </linearGradient>
                        <linearGradient id="paint2_linear_595_14217" x1="649" y1="633" x2="649" y2="653"
                            gradientUnits="userSpaceOnUse">
                            <stop stop-color="white" stop-opacity="0" />
                            <stop offset="0.480769" stop-color="#CACACA" />
                            <stop offset="1" stop-color="#999999" stop-opacity="0" />
                        </linearGradient>
                        <linearGradient id="paint3_linear_595_14217" x1="696" y1="633" x2="696" y2="653"
                            gradientUnits="userSpaceOnUse">
                            <stop stop-color="white" stop-opacity="0" />
                            <stop offset="0.480769" stop-color="#CACACA" />
                            <stop offset="1" stop-color="#999999" stop-opacity="0" />
                        </linearGradient>
                    </defs>
                </svg>
                <div class="panes-container">
                    <div id="pane-left" class="webview-pane"></div>
                    <div class="spacer"></div>
                    <div id="pane-right" class="webview-pane"></div>
                </div>
            </div>

            <div class="task-panel-wrapper">
                <svg class="task-panel-svg" viewBox="0 0 250 658" fill="none" xmlns="http://www.w3.org/2000/svg"
                    preserveAspectRatio="none">
                    <path id="task-panel-path" d="" fill="transparent" />
                </svg>
            </div>
        </div>

        <script>
            const container = document.getElementById('main-container');
            const trigger = document.getElementById('panel-trigger');
            const splitTrigger = document.getElementById('splitview-trigger');
            const maskFull = document.getElementById('mask-full');
            const maskSplit = document.getElementById('mask-split-views');
            const leftPaneMask = document.getElementById('pane-left-mask-path');
            const rightPaneMask = document.getElementById('pane-right-mask-path');
            const canvasPath = document.getElementById('main-canvas-path');
            const dockElements = document.getElementById('dock-elements');
            const splitDivider = document.getElementById('splitview-divider');
            const wrapper = container.querySelector('.main-canvas-wrapper');
            const taskPanelPath = document.getElementById('task-panel-path');
            const overlaySvg = document.querySelector('.canvas-overlay-svg');
            const panesContainer = document.querySelector('.panes-container');
            const maskSplitGroup = document.getElementById('mask-split-group');
            const zipperRectSplit = document.getElementById('zipper-rect-split');
            const zipperRectFull = document.getElementById('zipper-rect-full');

            let splitRatio = 0.5;
            let isDragging = false;
            let zipperProgress = 0; // 0 to 1
            let isZipperAnimating = false;

            const updateGeometry = () => {
                const w = wrapper.offsetWidth;
                const h = wrapper.offsetHeight;

                const svg = canvasPath.closest('svg');
                svg.setAttribute('viewBox', `0 0 ${w} ${h}`);
                overlaySvg.setAttribute('viewBox', `0 0 ${w} ${h}`);

                const L = 0, R = w;
                const splitX = Math.round(w * splitRatio);
                const rad = 5, bottom = h - 1, dockTop = h - 31, dockCenter = Math.round(w / 2);

                // Dock segments
                const dL = dockCenter - 121, dR = dockCenter + 119;
                const dC1 = dockCenter - 96, dC2 = dockCenter - 71, dC3 = dockCenter + 69, dC4 = dockCenter + 94;

                const fullD = `M ${L + rad} 1 H ${R - rad} Q ${R} 1 ${R} ${1 + rad} V ${bottom - rad} Q ${R} ${bottom} ${R - rad} ${bottom} H ${dR} C ${dC4} ${bottom} ${dC4} ${dockTop} ${dC3} ${dockTop} H ${dC2} C ${dC1} ${dockTop} ${dC1} ${bottom} ${dL} ${bottom} H ${L + rad} Q ${L} ${bottom} ${L} ${bottom - rad} V ${1 + rad} Q ${L} 1 ${L + rad} 1 Z`;

                const leftD = `M ${L + rad} 1 H ${splitX - 2 - rad} Q ${splitX - 2} 1 ${splitX - 2} ${1 + rad} V ${h} H ${L + rad} Q ${L} ${bottom} ${L} ${bottom - rad} V ${1 + rad} Q ${L} 1 ${L + rad} 1 Z`;
                const rightD = `M ${splitX + 2 + rad} 1 H ${R - rad} Q ${R} 1 ${R} ${1 + rad} V ${bottom - rad} Q ${R} ${bottom} ${R - rad} ${bottom} H ${splitX + 2} V ${1 + rad} Q ${splitX + 2} 1 ${splitX + 2 + rad} 1 Z`;

                canvasPath.setAttribute('d', fullD);
                maskFull.setAttribute('d', fullD);
                leftPaneMask.setAttribute('d', leftD);
                rightPaneMask.setAttribute('d', rightD);

                // Update Task Panel Path (250px width)
                const taskH = container.querySelector('.task-panel-wrapper').offsetHeight || 658;
                const taskW = 250;
                const taskRad = 5;
                const taskBottom = taskH - 1;
                const taskD = `M 0 ${taskBottom - taskRad} V ${taskRad} Q 0 1 ${taskRad} 1 H ${taskW - taskRad} Q ${taskW} 1 ${taskW} ${taskRad} V ${taskBottom - taskRad} Q ${taskW} ${taskBottom} ${taskW - taskRad} ${taskBottom} H ${taskRad} Q 0 ${taskBottom} 0 ${taskBottom - taskRad} Z`;
                if (taskPanelPath) taskPanelPath.setAttribute('d', taskD);

                dockElements.setAttribute('transform', `translate(${dockCenter - 618}, ${h - 658})`);
                splitDivider.setAttribute('transform', `translate(${splitX - 2}, 0)`);

                const isActive = container.classList.contains('splitview-active');

                // Zipper logic
                const zipperY = h * zipperProgress;
                maskSplitGroup.style.display = 'block'; // Always block when animating or active

                // Apply clipping to simulate zipper
                document.getElementById('mask-full-group').setAttribute('clip-path', 'url(#zipper-clip-full)');
                maskSplitGroup.setAttribute('clip-path', 'url(#zipper-clip-split)');

                zipperRectSplit.setAttribute('height', zipperY);
                zipperRectFull.setAttribute('y', zipperY);
                zipperRectFull.setAttribute('height', h - zipperY);

                // Divider Logic: Must follow dock shape
                const divHandle = document.getElementById('divider-handle');

                // Determine handle snapping position: follows zipper during animation, then centers
                const targetHandleY = isZipperAnimating ? zipperY - 25 : (h / 2) - 25;
                divHandle.setAttribute('y', Math.max(0, Math.min(h - 50, targetHandleY)));

                if (isActive || isZipperAnimating) {
                    panesContainer.style.display = 'grid';
                    panesContainer.style.gridTemplateColumns = `${splitX - 2}px 4px ${w - splitX - 2}px`;
                    canvasPath.setAttribute('mask', 'url(#split-mask)');
                    resetIdleTimer();
                } else {
                    panesContainer.style.display = 'none';
                    canvasPath.removeAttribute('mask');
                }

                splitDivider.style.display = (isActive || isZipperAnimating) ? 'block' : 'none';
                // splitDivider.style.opacity = zipperProgress; // Fade in with zipper - removed as per instruction
            };

            const startZipperAnimation = (forward) => {
                isZipperAnimating = true;
                const duration = 650; // ms
                const startTime = performance.now();
                const startVal = zipperProgress;
                const endVal = forward ? 1 : 0;

                const step = (now) => {
                    const elapsed = now - startTime;
                    const p = Math.min(elapsed / duration, 1);

                    // Ease out cubic
                    const ease = 1 - Math.pow(1 - p, 3);

                    zipperProgress = startVal + (endVal - startVal) * ease;
                    updateGeometry();

                    if (p < 1) {
                        requestAnimationFrame(step);
                    } else {
                        isZipperAnimating = false;
                        zipperProgress = endVal;
                        updateGeometry();

                        // New Phase: Progressive appearance of the handle
                        if (forward) {
                            splitDivider.classList.add('active-handle');
                        } else {
                            splitDivider.classList.remove('active-handle');
                        }
                    }
                };

                if (!forward) {
                    splitDivider.classList.remove('active-handle');
                }
                requestAnimationFrame(step);
            };

            let idleTimer;
            const resetIdleTimer = () => {
                if (!splitDivider) return;
                splitDivider.classList.remove('idle');
                clearTimeout(idleTimer);
                idleTimer = setTimeout(() => {
                    if (!isDragging) {
                        splitDivider.classList.add('idle');
                    }
                }, 5000); // 5 seconds
            };

            window.addEventListener('mousemove', resetIdleTimer);
            window.addEventListener('mousedown', resetIdleTimer);

            const onMouseMove = (e) => {
                if (!isDragging) return;
                const rect = wrapper.getBoundingClientRect();
                let x = e.clientX - rect.left;

                // Constraints: 250px min per pane
                const minSide = 250;
                if (x < minSide) x = minSide;
                if (x > rect.width - minSide) x = rect.width - minSide;

                // Magnetic Snap Points (Tier Elite implementation)
                const snapThreshold = 8;
                const centerX = rect.width / 2;
                const snapPoints = [
                    minSide,                // Left lateral stop
                    rect.width * 0.25,     // Left pane midpoint
                    centerX,                // Main center
                    rect.width * 0.75,     // Right pane midpoint
                    rect.width - minSide    // Right lateral stop
                ];

                for (const p of snapPoints) {
                    if (Math.abs(x - p) < snapThreshold) {
                        x = p;
                        break;
                    }
                }

                splitRatio = x / rect.width;
                updateGeometry();
            };

            const onMouseUp = () => {
                isDragging = false;
                document.body.style.cursor = 'default';
                window.removeEventListener('mousemove', onMouseMove);
                window.removeEventListener('mouseup', onMouseUp);
            };

            splitDivider.addEventListener('mousedown', (e) => {
                isDragging = true;
                document.body.style.cursor = 'col-resize';
                window.addEventListener('mousemove', onMouseMove);
                window.addEventListener('mouseup', onMouseUp);
                e.preventDefault();
            });

            const resizeObserver = new ResizeObserver(() => {
                updateGeometry();
            });
            resizeObserver.observe(wrapper);

            // Initial alignment
            updateGeometry();

            trigger.addEventListener('click', () => {
                container.classList.toggle('container-panel-open');
                // Allow transition to finish then update geometry (or observer will handle it)
            });

            splitTrigger.addEventListener('click', () => {
                const becomingActive = !container.classList.contains('splitview-active');
                container.classList.toggle('splitview-active');
                startZipperAnimation(becomingActive);
            });
        </script>
    </div>
</body>

</html>