<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Desktop Shell</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: transparent;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            overflow: hidden;
        }

        .window-container {
            width: 100vw;
            height: 100vh;
            position: relative;
            background: transparent;
        }

        .notch-container {
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            z-index: 10;
        }

        .notch-svg {
            width: 300px;
            height: 20px;
        }

        .canvas-task-container {
            position: absolute;
            top: 35px;
            left: 7px;
            right: 7px;
            bottom: 7px;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 0;
            transition: gap 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .container-panel-open {
            gap: 4px;
        }

        .main-canvas-wrapper {
            height: 100%;
            flex: 1;
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            min-width: 0;
        }

        .task-panel-wrapper {
            width: 0;
            height: 100%;
            overflow: hidden;
            transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            flex-shrink: 0;
        }

        .container-panel-open .task-panel-wrapper {
            width: 250px;
        }

        .canvas-task-svg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: block;
        }

        .task-panel-svg {
            display: block;
            width: 100%;
            /* Make task panel SVG responsive to its wrapper */
            height: 100%;
        }

        .dock-icon {
            cursor: pointer;
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            transform-origin: center;
            transform-box: fill-box;
            will-change: transform;
        }

        .dock-icon:hover {
            transform: scale3d(1.167, 1.167, 1);
        }

        .dock-icon-area {
            fill: transparent;
            cursor: pointer;
        }

        /* Functional SplitView Panes (Tier II Elite Implementation) */
        .panes-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: none;
            grid-template-columns: 1fr 4px 1fr;
            z-index: 5;
            pointer-events: none;
            mask: url(#split-mask);
            -webkit-mask: url(#split-mask);
        }

        .splitview-active .panes-container {
            display: grid;
        }

        .webview-pane {
            pointer-events: auto;
            position: relative;
            overflow: hidden;
            background: #0A0A0A;
            border-radius: 5px;
        }

        #splitview-trigger {
            cursor: pointer;
        }

        .canvas-overlay-svg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: block;
            z-index: 15;
            pointer-events: none;
        }

        .canvas-overlay-svg * {
            pointer-events: auto;
        }

        #splitview-divider {
            cursor: col-resize;
        }

        #divider-handle {
            opacity: 0;
            transition: opacity 1s ease-in-out;
        }

        #splitview-divider.active-handle #divider-handle {
            opacity: 1;
        }

        #splitview-divider.idle #divider-handle {
            opacity: 0.25;
        }

        #splitview-divider:hover #divider-handle {
            opacity: 1 !important;
        }
    </style>
</head>

<body>
    <div class="window-container">
        <div class="notch-container">
            <svg class="notch-svg" width="300" height="20" viewBox="0 0 300 20" fill="none"
                xmlns="http://www.w3.org/2000/svg">
                <path d="M 0 0 C 12.5 0 12.5 20 25 20 H 275 C 287.5 20 287.5 0 300 0 Z" fill="#0A0A0A" />
            </svg>
        </div>
        <div class="canvas-task-container" id="main-container">
            <div class="main-canvas-wrapper">
                <svg class="canvas-task-svg" viewBox="0 0 1236 658" fill="none" xmlns="http://www.w3.org/2000/svg"
                    preserveAspectRatio="none">
                    <g clip-path="url(#clip0_595_14217)">
                        <path id="main-canvas-path" d="" fill="#0A0A0A" />
                        <defs>
                            <clipPath id="clip0_595_14217">
                                <rect width="100%" height="100%" fill="white" />
                            </clipPath>
                            <mask id="split-mask">
                                <g id="mask-full-group">
                                    <path id="mask-full" d="" fill="white" />
                                </g>
                                <g id="mask-split-group" style="display: none;">
                                    <path id="pane-left-mask-path" d="" fill="white" />
                                    <path id="pane-right-mask-path" d="" fill="white" />
                                </g>
                            </mask>
                            <clipPath id="zipper-clip-split">
                                <rect id="zipper-rect-split" x="0" y="0" width="100%" height="0" />
                            </clipPath>
                            <clipPath id="zipper-clip-full">
                                <rect id="zipper-rect-full" x="0" y="0" width="100%" height="100%" />
                            </clipPath>
                        </defs>
                    </g>
                </svg>

                <svg class="canvas-overlay-svg" viewBox="0 0 1236 658" fill="none" xmlns="http://www.w3.org/2000/svg"
                    preserveAspectRatio="none">
                    <!-- SplitView Separator (Elite Transparency) -->
                    <g id="splitview-divider" style="display: none;">
                        <rect x="-2" y="0" width="11" height="100%" fill="transparent" />
                        <rect id="divider-handle" x="1" y="289.5" width="2" height="50" rx="1" fill="#999999" />
                    </g>

                    <g id="dock-elements">
                        <!-- Separator 1 -->
                        <line x1="545" y1="640" x2="545" y2="651" stroke="url(#paint0_linear_595_14217)"
                            stroke-width="0.3" stroke-linecap="round" />

                        <!-- SplitView Trigger: Box(555, 634.5, 22, 22) Center(566, 645.5) -->
                        <g class="dock-icon" id="splitview-trigger">
                            <rect class="dock-icon-area" x="555" y="634.5" width="22" height="22" />
                            <path
                                d="M564 650.5H562C561.4 650.5 561 650.1 561 649.5V641.5C561 640.9 561.4 640.5 562 640.5H564"
                                stroke="#D1D1D1" stroke-width="0.8" stroke-linecap="round" />
                            <path
                                d="M568 650.5H570C570.6 650.5 571 650.1 571 649.5V641.5C571 640.9 570.6 640.5 570 640.5H568"
                                stroke="#D1D1D1" stroke-width="0.8" stroke-linecap="round" />
                            <path d="M566 638.5V652.5" stroke="#D1D1D1" stroke-width="0.8" stroke-linecap="round" />
                        </g>

                        <!-- Separator 2 -->
                        <line x1="587" y1="640" x2="587" y2="651" stroke="url(#paint1_linear_595_14217)"
                            stroke-width="0.3" stroke-linecap="round" />

                        <!-- Center Icon (Home): Box(597, 634.5, 22, 22) Center(608, 645.5) -->
                        <g class="dock-icon">
                            <rect class="dock-icon-area" x="597" y="634.5" width="22" height="22" />
                            <path
                                d="M603 645.5C603 644.5 603 644 603.2 643.6C603.4 643.2 603.8 642.9 604.6 642.3L605.2 641.7C606.5 640.5 607.3 640 608 640C608.7 640 609.5 640.5 610.8 641.7L611.4 642.3C612.2 642.9 612.6 643.2 612.8 643.6C613 644 613 644.5 613 645.5V648.5C613 649.8 613 650.5 612.6 650.9C612.2 651.3 611.5 651.3 610.2 651.3H605.8C604.5 651.3 603.8 651.3 603.4 650.9C603 650.5 603 649.8 603 648.5V645.5Z"
                                stroke="#D1D1D1" stroke-width="1" />
                            <path d="M608 651.3V647.5" stroke="#D1D1D1" stroke-width="0.8" stroke-linecap="round" />
                        </g>

                        <!-- Separator 3 -->
                        <line x1="629" y1="640" x2="629" y2="651" stroke="url(#paint2_linear_595_14217)"
                            stroke-width="0.3" stroke-linecap="round" />

                        <!-- Task Panel Trigger: Box(639, 634.5, 22, 22) Center(650, 645.5) -->
                        <g class="dock-icon" id="panel-trigger">
                            <rect class="dock-icon-area" x="639" y="634.5" width="22" height="22" />
                            <path
                                d="M649 651H645.5C644.8 651 644.2 650.4 644.2 649.7V641.3C644.2 640.6 644.8 640 645.5 640H649"
                                stroke="#D1D1D1" stroke-width="0.8" stroke-linecap="round" />
                            <path
                                d="M651 651H654.5C655.2 651 655.8 650.4 655.8 649.7V641.3C655.8 640.6 655.2 640 654.5 640H651"
                                stroke="#D1D1D1" stroke-width="0.8" stroke-linecap="round" />
                            <rect x="651" y="641" width="4" height="9" rx="0.7" fill="#D1D1D1" />
                        </g>

                        <!-- Separator 4 -->
                        <line x1="671" y1="640" x2="671" y2="651" stroke="url(#paint3_linear_595_14217)"
                            stroke-width="0.3" stroke-linecap="round" />
                    </g>
                    <defs>
                        <linearGradient id="paint0_linear_595_14217" x1="539" y1="633" x2="539" y2="653"
                            gradientUnits="userSpaceOnUse">
                            <stop stop-color="white" stop-opacity="0" />
                            <stop offset="0.480769" stop-color="#CACACA" />
                            <stop offset="1" stop-color="#999999" stop-opacity="0" />
                        </linearGradient>
                        <linearGradient id="paint1_linear_595_14217" x1="602" y1="633" x2="602" y2="653"
                            gradientUnits="userSpaceOnUse">
                            <stop stop-color="white" stop-opacity="0" />
                            <stop offset="0.480769" stop-color="#CACACA" />
                            <stop offset="1" stop-color="#999999" stop-opacity="0" />
                        </linearGradient>
                        <linearGradient id="paint2_linear_595_14217" x1="649" y1="633" x2="649" y2="653"
                            gradientUnits="userSpaceOnUse">
                            <stop stop-color="white" stop-opacity="0" />
                            <stop offset="0.480769" stop-color="#CACACA" />
                            <stop offset="1" stop-color="#999999" stop-opacity="0" />
                        </linearGradient>
                        <linearGradient id="paint3_linear_595_14217" x1="696" y1="633" x2="696" y2="653"
                            gradientUnits="userSpaceOnUse">
                            <stop stop-color="white" stop-opacity="0" />
                            <stop offset="0.480769" stop-color="#CACACA" />
                            <stop offset="1" stop-color="#999999" stop-opacity="0" />
                        </linearGradient>
                    </defs>
                </svg>
                <div class="panes-container">
                    <div id="pane-left" class="webview-pane"></div>
                    <div class="spacer"></div>
                    <div id="pane-right" class="webview-pane"></div>
                </div>
            </div>

            <div class="task-panel-wrapper">
                <svg class="task-panel-svg" viewBox="0 0 250 658" fill="none" xmlns="http://www.w3.org/2000/svg"
                    preserveAspectRatio="none">
                    <path id="task-panel-path" d="" fill="transparent" />
                </svg>
            </div>
        </div>

        <script>
            const container = document.getElementById('main-container');
            const trigger = document.getElementById('panel-trigger');
            const splitTrigger = document.getElementById('splitview-trigger');
            const maskFull = document.getElementById('mask-full');
            const maskSplitSil = document.getElementById('pane-left-mask-path');
            const maskSplitGap = document.getElementById('pane-right-mask-path');
            const maskSplitGroup = document.getElementById('mask-split-group');
            const canvasPath = document.getElementById('main-canvas-path');
            const dockElements = document.getElementById('dock-elements');
            const splitDivider = document.getElementById('splitview-divider');
            const wrapper = container.querySelector('.main-canvas-wrapper');
            const taskPanelPath = document.getElementById('task-panel-path');
            const overlaySvg = document.querySelector('.canvas-overlay-svg');
            const panesContainer = document.querySelector('.panes-container');
            const zipperRectSplit = document.getElementById('zipper-rect-split');
            const zipperRectFull = document.getElementById('zipper-rect-full');

            let splitRatio = 0.5;
            let isDragging = false;
            let zipperProgress = 0; // 0 to 1
            let isZipperAnimating = false;

            const updateGeometry = () => {
                const w = wrapper.offsetWidth;
                const h = wrapper.offsetHeight;

                const svg = canvasPath.closest('svg');
                svg.setAttribute('viewBox', `0 0 ${w} ${h}`);
                overlaySvg.setAttribute('viewBox', `0 0 ${w} ${h}`);

                const L = 0, R = w;
                const splitX = Math.round(w * splitRatio);
                const rad = 5, bottom = h - 1, dockTop = h - 26, dockCenter = Math.round(w / 2);

                // Dock segments: 300px total width with 50px curves
                const dL = dockCenter - 150, dR = dockCenter + 150;
                const dC1 = dockCenter - 125, dC2 = dockCenter - 100, dC3 = dockCenter + 100, dC4 = dockCenter + 125;

                // Precision divEndY: Smooth interpolation for Dock curves
                let divEndY = bottom;
                if (splitX >= dC2 && splitX <= dC3) divEndY = dockTop;
                else if (splitX >= dL && splitX < dC2) {
                    const t = (splitX - dL) / (dC2 - dL);
                    divEndY = bottom - (bottom - dockTop) * (3 * t * t - 2 * t * t * t);
                } else if (splitX > dC3 && splitX <= dR) {
                    const t = (splitX - dC3) / (dR - dC3);
                    divEndY = dockTop + (bottom - dockTop) * (3 * t * t - 2 * t * t * t);
                }

                const fullD = `M ${L + rad} 1 H ${R - rad} Q ${R} 1 ${R} ${1 + rad} V ${bottom - rad} Q ${R} ${bottom} ${R - rad} ${bottom} H ${dR} C ${dC4} ${bottom} ${dC4} ${dockTop} ${dC3} ${dockTop} H ${dC2} C ${dC1} ${dockTop} ${dC1} ${bottom} ${dL} ${bottom} H ${L + rad} Q ${L} ${bottom} ${L} ${bottom - rad} V ${1 + rad} Q ${L} 1 ${L + rad} 1 Z`;

                canvasPath.setAttribute('d', fullD);
                maskFull.setAttribute('d', fullD);

                // Build Precision Masks with true 5px internal rounding
                const iRad = 5;
                let leftD_final = `M ${L + rad} 1 H ${splitX - 2 - iRad} Q ${splitX - 2} 1 ${splitX - 2} ${1 + iRad} V ${divEndY - iRad} Q ${splitX - 2} ${divEndY} ${splitX - 2 - iRad} ${divEndY} `;
                if (splitX - 2 > dR) leftD_final += `H ${dR} C ${dC4} ${bottom} ${dC4} ${dockTop} ${dC3} ${dockTop} H ${dC2} C ${dC1} ${dockTop} ${dC1} ${bottom} ${dL} ${bottom} `;
                else if (splitX - 2 > dC3) leftD_final += `L ${dC3} ${dockTop} H ${dC2} C ${dC1} ${dockTop} ${dC1} ${bottom} ${dL} ${bottom} `;
                else if (splitX - 2 > dC2) leftD_final += `L ${dC2} ${dockTop} C ${dC1} ${dockTop} ${dC1} ${bottom} ${dL} ${bottom} `;
                else if (splitX - 2 > dL) leftD_final += `L ${dL} ${bottom} `;
                leftD_final += `H ${L + rad} Q ${L} ${bottom} ${L} ${bottom - rad} V ${1 + rad} Q ${L} 1 ${L + rad} 1 Z`;

                let rightD_final = `M ${splitX + 2 + iRad} 1 H ${R - rad} Q ${R} 1 ${R} ${1 + rad} V ${bottom - rad} Q ${R} ${bottom} ${R - rad} ${bottom} `;
                if (splitX + 2 < dL) rightD_final += `H ${dR} C ${dC4} ${bottom} ${dC4} ${dockTop} ${dC3} ${dockTop} H ${dC2} C ${dC1} ${dockTop} ${dC1} ${bottom} ${dL} ${bottom} `;
                else if (splitX + 2 < dC2) rightD_final += `H ${dR} C ${dC4} ${bottom} ${dC4} ${dockTop} ${dC3} ${dockTop} H ${dC2} C ${dC1} ${dockTop} ${dC1} ${bottom} ${splitX + 2 + rad} ${divEndY} `;
                else if (splitX + 2 < dC3) rightD_final += `H ${dR} C ${dC4} ${bottom} ${dC4} ${dockTop} ${dC3} ${dockTop} L ${splitX + 2 + rad} ${divEndY} `;
                else if (splitX + 2 < dR) rightD_final += `H ${dR} C ${dC4} ${bottom} ${dC4} ${dockTop} L ${splitX + 2 + rad} ${divEndY} `;
                else rightD_final += `H ${splitX + 2 + rad} `;
                rightD_final += `Q ${splitX + 2} ${divEndY} ${splitX + 2} ${divEndY - iRad} V ${1 + iRad} Q ${splitX + 2} 1 ${splitX + 2 + iRad} 1 Z`;

                maskSplitSil.setAttribute('d', leftD_final);
                maskSplitGap.setAttribute('d', rightD_final);

                // Update Task Panel Path (250px width)
                const taskH = container.querySelector('.task-panel-wrapper').offsetHeight || 658;
                const taskW = 250;
                const taskRad = 5;
                const taskBottom = taskH - 1;
                const taskD = `M 0 ${taskBottom - taskRad} V ${taskRad} Q 0 1 ${taskRad} 1 H ${taskW - taskRad} Q ${taskW} 1 ${taskW} ${taskRad} V ${taskBottom - taskRad} Q ${taskW} ${taskBottom} ${taskW - taskRad} ${taskBottom} H ${taskRad} Q 0 ${taskBottom} 0 ${taskBottom - taskRad} Z`;
                if (taskPanelPath) taskPanelPath.setAttribute('d', taskD);

                dockElements.setAttribute('transform', `translate(${dockCenter - 608}, ${h - 658})`);
                splitDivider.setAttribute('transform', `translate(${splitX - 2}, 0)`);

                const isActive = container.classList.contains('splitview-active');

                // Zipper logic
                const zipperY = h * zipperProgress;
                maskSplitGroup.style.display = 'block'; // Always block when animating or active

                // Apply clipping to simulate zipper
                document.getElementById('mask-full-group').setAttribute('clip-path', 'url(#zipper-clip-full)');
                maskSplitGroup.setAttribute('clip-path', 'url(#zipper-clip-split)');

                zipperRectSplit.setAttribute('height', zipperY);
                zipperRectFull.setAttribute('y', zipperY);
                zipperRectFull.setAttribute('height', h - zipperY);

                // Divider Logic: Must follow dock shape
                const divHandle = document.getElementById('divider-handle');

                // Determine handle snapping position: follows zipper during animation, then centers
                const targetHandleY = isZipperAnimating ? zipperY - 25 : (h / 2) - 25;
                divHandle.setAttribute('y', Math.max(0, Math.min(h - 50, targetHandleY)));

                if (isActive || isZipperAnimating) {
                    panesContainer.style.display = 'grid';
                    panesContainer.style.gridTemplateColumns = `${splitX - 2}px 4px ${w - splitX - 2}px`;
                    canvasPath.setAttribute('mask', 'url(#split-mask)');
                    resetIdleTimer();
                } else {
                    panesContainer.style.display = 'none';
                    canvasPath.removeAttribute('mask');
                }

                splitDivider.style.display = (isActive || isZipperAnimating) ? 'block' : 'none';
                // splitDivider.style.opacity = zipperProgress; // Fade in with zipper - removed as per instruction
            };

            const startZipperAnimation = (forward) => {
                isZipperAnimating = true;
                const duration = 650; // ms
                const startTime = performance.now();
                const startVal = zipperProgress;
                const endVal = forward ? 1 : 0;

                const step = (now) => {
                    const elapsed = now - startTime;
                    const p = Math.min(elapsed / duration, 1);

                    // Ease out cubic
                    const ease = 1 - Math.pow(1 - p, 3);

                    zipperProgress = startVal + (endVal - startVal) * ease;
                    updateGeometry();

                    if (p < 1) {
                        requestAnimationFrame(step);
                    } else {
                        isZipperAnimating = false;
                        zipperProgress = endVal;
                        updateGeometry();

                        // New Phase: Progressive appearance of the handle
                        if (forward) {
                            splitDivider.classList.add('active-handle');
                        } else {
                            splitDivider.classList.remove('active-handle');
                        }
                    }
                };

                if (!forward) {
                    splitDivider.classList.remove('active-handle');
                }
                requestAnimationFrame(step);
            };

            let idleTimer;
            const resetIdleTimer = () => {
                if (!splitDivider) return;
                splitDivider.classList.remove('idle');
                clearTimeout(idleTimer);
                idleTimer = setTimeout(() => {
                    if (!isDragging) {
                        splitDivider.classList.add('idle');
                    }
                }, 4000); // 4 seconds
            };

            window.addEventListener('mousemove', resetIdleTimer);
            window.addEventListener('mousedown', resetIdleTimer);

            const onMouseMove = (e) => {
                if (!isDragging) return;
                const rect = wrapper.getBoundingClientRect();
                const totalW = rect.width;
                if (totalW === 0) return;

                let x = e.clientX - rect.left;

                // Constraints: 250px min per pane (Tier Elite Resolution)
                const minSide = 250;
                if (x < minSide) x = minSide;
                if (x > totalW - minSide) x = totalW - minSide;

                // Magnetic Snap Points (Symmetric Edges and Center)
                const snapThreshold = 35;
                const snapPoints = [
                    minSide,                // Left lateral stop
                    totalW / 2,             // Main center
                    totalW - minSide        // Right lateral stop
                ];

                for (const p of snapPoints) {
                    if (Math.abs(x - p) < snapThreshold) {
                        x = p;
                        break;
                    }
                }

                splitRatio = x / totalW;
                updateGeometry();
            };

            const onMouseUp = () => {
                isDragging = false;
                document.body.style.cursor = 'default';
                window.removeEventListener('mousemove', onMouseMove);
                window.removeEventListener('mouseup', onMouseUp);
            };

            splitDivider.addEventListener('mousedown', (e) => {
                isDragging = true;
                document.body.style.cursor = 'col-resize';
                window.addEventListener('mousemove', onMouseMove);
                window.addEventListener('mouseup', onMouseUp);
                e.preventDefault();
            });

            const resizeObserver = new ResizeObserver(() => {
                updateGeometry();
            });
            resizeObserver.observe(wrapper);

            // Initial alignment
            updateGeometry();

            trigger.addEventListener('click', () => {
                container.classList.toggle('container-panel-open');
                // Allow transition to finish then update geometry (or observer will handle it)
            });

            splitTrigger.addEventListener('click', () => {
                const becomingActive = !container.classList.contains('splitview-active');
                container.classList.toggle('splitview-active');
                startZipperAnimation(becomingActive);
            });
        </script>
    </div>
</body>

</html>